"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.setupUpLinks = setupUpLinks;
exports.updateVersionsHiddenUpLink = updateVersionsHiddenUpLink;

var _upStorage = _interopRequireDefault(require("./up-storage"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * Set up the Up Storage for each link.
 */
function setupUpLinks(config) {
  const uplinks = {};

  for (const uplinkName in config.uplinks) {
    if (Object.prototype.hasOwnProperty.call(config.uplinks, uplinkName)) {
      // instance for each up-link definition
      const proxy = new _upStorage.default(config.uplinks[uplinkName], config);
      proxy.upname = uplinkName;
      uplinks[uplinkName] = proxy;
    }
  }

  return uplinks;
}

function updateVersionsHiddenUpLink(versions, upLink) {
  for (const i in versions) {
    if (Object.prototype.hasOwnProperty.call(versions, i)) {
      const version = versions[i]; // holds a "hidden" value to be used by the package storage.
      // $FlowFixMe

      version[Symbol.for('__verdaccio_uplink')] = upLink.upname;
    }
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9saWIvdXBsaW5rLXV0aWwudHMiXSwibmFtZXMiOlsic2V0dXBVcExpbmtzIiwiY29uZmlnIiwidXBsaW5rcyIsInVwbGlua05hbWUiLCJPYmplY3QiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJwcm94eSIsIlByb3h5U3RvcmFnZSIsInVwbmFtZSIsInVwZGF0ZVZlcnNpb25zSGlkZGVuVXBMaW5rIiwidmVyc2lvbnMiLCJ1cExpbmsiLCJpIiwidmVyc2lvbiIsIlN5bWJvbCIsImZvciJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFFQTs7OztBQUVBO0FBQ0E7QUFDQTtBQUNPLFNBQVNBLFlBQVQsQ0FBc0JDLE1BQXRCLEVBQWlEO0FBQ3RELFFBQU1DLE9BQWtCLEdBQUcsRUFBM0I7O0FBRUEsT0FBSyxNQUFNQyxVQUFYLElBQXlCRixNQUFNLENBQUNDLE9BQWhDLEVBQXlDO0FBQ3ZDLFFBQUlFLE1BQU0sQ0FBQ0MsU0FBUCxDQUFpQkMsY0FBakIsQ0FBZ0NDLElBQWhDLENBQXFDTixNQUFNLENBQUNDLE9BQTVDLEVBQXFEQyxVQUFyRCxDQUFKLEVBQXNFO0FBQ3BFO0FBQ0EsWUFBTUssS0FBYSxHQUFHLElBQUlDLGtCQUFKLENBQWlCUixNQUFNLENBQUNDLE9BQVAsQ0FBZUMsVUFBZixDQUFqQixFQUE2Q0YsTUFBN0MsQ0FBdEI7QUFDQU8sTUFBQUEsS0FBSyxDQUFDRSxNQUFOLEdBQWVQLFVBQWY7QUFFQUQsTUFBQUEsT0FBTyxDQUFDQyxVQUFELENBQVAsR0FBc0JLLEtBQXRCO0FBQ0Q7QUFDRjs7QUFFRCxTQUFPTixPQUFQO0FBQ0Q7O0FBRU0sU0FBU1MsMEJBQVQsQ0FBb0NDLFFBQXBDLEVBQXdEQyxNQUF4RCxFQUE4RTtBQUNuRixPQUFLLE1BQU1DLENBQVgsSUFBZ0JGLFFBQWhCLEVBQTBCO0FBQ3hCLFFBQUlSLE1BQU0sQ0FBQ0MsU0FBUCxDQUFpQkMsY0FBakIsQ0FBZ0NDLElBQWhDLENBQXFDSyxRQUFyQyxFQUErQ0UsQ0FBL0MsQ0FBSixFQUF1RDtBQUNyRCxZQUFNQyxPQUFPLEdBQUdILFFBQVEsQ0FBQ0UsQ0FBRCxDQUF4QixDQURxRCxDQUdyRDtBQUNBOztBQUNBQyxNQUFBQSxPQUFPLENBQUNDLE1BQU0sQ0FBQ0MsR0FBUCxDQUFXLG9CQUFYLENBQUQsQ0FBUCxHQUE0Q0osTUFBTSxDQUFDSCxNQUFuRDtBQUNEO0FBQ0Y7QUFDRiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFZlcnNpb25zLCBDb25maWcgfSBmcm9tICdAdmVyZGFjY2lvL3R5cGVzJztcbmltcG9ydCB7IElQcm94eSwgUHJveHlMaXN0IH0gZnJvbSAnLi4vLi4vdHlwZXMnO1xuaW1wb3J0IFByb3h5U3RvcmFnZSBmcm9tICcuL3VwLXN0b3JhZ2UnO1xuXG4vKipcbiAqIFNldCB1cCB0aGUgVXAgU3RvcmFnZSBmb3IgZWFjaCBsaW5rLlxuICovXG5leHBvcnQgZnVuY3Rpb24gc2V0dXBVcExpbmtzKGNvbmZpZzogQ29uZmlnKTogUHJveHlMaXN0IHtcbiAgY29uc3QgdXBsaW5rczogUHJveHlMaXN0ID0ge307XG5cbiAgZm9yIChjb25zdCB1cGxpbmtOYW1lIGluIGNvbmZpZy51cGxpbmtzKSB7XG4gICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChjb25maWcudXBsaW5rcywgdXBsaW5rTmFtZSkpIHtcbiAgICAgIC8vIGluc3RhbmNlIGZvciBlYWNoIHVwLWxpbmsgZGVmaW5pdGlvblxuICAgICAgY29uc3QgcHJveHk6IElQcm94eSA9IG5ldyBQcm94eVN0b3JhZ2UoY29uZmlnLnVwbGlua3NbdXBsaW5rTmFtZV0sIGNvbmZpZyk7XG4gICAgICBwcm94eS51cG5hbWUgPSB1cGxpbmtOYW1lO1xuXG4gICAgICB1cGxpbmtzW3VwbGlua05hbWVdID0gcHJveHk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHVwbGlua3M7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB1cGRhdGVWZXJzaW9uc0hpZGRlblVwTGluayh2ZXJzaW9uczogVmVyc2lvbnMsIHVwTGluazogSVByb3h5KTogdm9pZCB7XG4gIGZvciAoY29uc3QgaSBpbiB2ZXJzaW9ucykge1xuICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwodmVyc2lvbnMsIGkpKSB7XG4gICAgICBjb25zdCB2ZXJzaW9uID0gdmVyc2lvbnNbaV07XG5cbiAgICAgIC8vIGhvbGRzIGEgXCJoaWRkZW5cIiB2YWx1ZSB0byBiZSB1c2VkIGJ5IHRoZSBwYWNrYWdlIHN0b3JhZ2UuXG4gICAgICAvLyAkRmxvd0ZpeE1lXG4gICAgICB2ZXJzaW9uW1N5bWJvbC5mb3IoJ19fdmVyZGFjY2lvX3VwbGluaycpXSA9IHVwTGluay51cG5hbWU7XG4gICAgfVxuICB9XG59XG4iXX0=
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.notifyRequest = notifyRequest;

var _isNil = _interopRequireDefault(require("lodash/isNil"));

var _debug = _interopRequireDefault(require("debug"));

var _request = _interopRequireDefault(require("request"));

var _logger = require("../logger");

var _constants = require("../constants");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const debug = (0, _debug.default)('verdaccio:notify-request');

function notifyRequest(options, content) {
  return new Promise((resolve, reject) => {
    (0, _request.default)(options, function (err, response, body) {
      if (err || response.statusCode >= _constants.HTTP_STATUS.BAD_REQUEST) {
        const errorMessage = (0, _isNil.default)(err) ? response.body : err.message;

        _logger.logger.error({
          errorMessage
        }, 'notify service has thrown an error: @{errorMessage}');

        reject(errorMessage);
      }

      _logger.logger.info({
        content
      }, 'A notification has been shipped: @{content}');

      if ((0, _isNil.default)(body) === false) {
        _logger.logger.debug({
          body
        }, ' body: @{body}');

        resolve(body);
      }

      reject(Error('body is missing'));
    });
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9saWIvbm90aWZ5L25vdGlmeS1yZXF1ZXN0LnRzIl0sIm5hbWVzIjpbImRlYnVnIiwibm90aWZ5UmVxdWVzdCIsIm9wdGlvbnMiLCJjb250ZW50IiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJlcnIiLCJyZXNwb25zZSIsImJvZHkiLCJzdGF0dXNDb2RlIiwiSFRUUF9TVEFUVVMiLCJCQURfUkVRVUVTVCIsImVycm9yTWVzc2FnZSIsIm1lc3NhZ2UiLCJsb2dnZXIiLCJlcnJvciIsImluZm8iLCJFcnJvciJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7O0FBRUEsTUFBTUEsS0FBSyxHQUFHLG9CQUFXLDBCQUFYLENBQWQ7O0FBQ08sU0FBU0MsYUFBVCxDQUF1QkMsT0FBdkIsRUFBZ0RDLE9BQWhELEVBQStFO0FBQ3BGLFNBQU8sSUFBSUMsT0FBSixDQUFZLENBQUNDLE9BQUQsRUFBVUMsTUFBVixLQUEyQjtBQUM1QywwQkFBUUosT0FBUixFQUFpQixVQUFVSyxHQUFWLEVBQWVDLFFBQWYsRUFBeUJDLElBQXpCLEVBQXFDO0FBQ3BELFVBQUlGLEdBQUcsSUFBSUMsUUFBUSxDQUFDRSxVQUFULElBQXVCQyx1QkFBWUMsV0FBOUMsRUFBMkQ7QUFDekQsY0FBTUMsWUFBWSxHQUFHLG9CQUFNTixHQUFOLElBQWFDLFFBQVEsQ0FBQ0MsSUFBdEIsR0FBNkJGLEdBQUcsQ0FBQ08sT0FBdEQ7O0FBQ0FDLHVCQUFPQyxLQUFQLENBQWE7QUFBRUgsVUFBQUE7QUFBRixTQUFiLEVBQStCLHFEQUEvQjs7QUFDQVAsUUFBQUEsTUFBTSxDQUFDTyxZQUFELENBQU47QUFDRDs7QUFDREUscUJBQU9FLElBQVAsQ0FBWTtBQUFFZCxRQUFBQTtBQUFGLE9BQVosRUFBeUIsNkNBQXpCOztBQUNBLFVBQUksb0JBQU1NLElBQU4sTUFBZ0IsS0FBcEIsRUFBMkI7QUFDekJNLHVCQUFPZixLQUFQLENBQWE7QUFBRVMsVUFBQUE7QUFBRixTQUFiLEVBQXVCLGdCQUF2Qjs7QUFDQUosUUFBQUEsT0FBTyxDQUFDSSxJQUFELENBQVA7QUFDRDs7QUFDREgsTUFBQUEsTUFBTSxDQUFDWSxLQUFLLENBQUMsaUJBQUQsQ0FBTixDQUFOO0FBQ0QsS0FaRDtBQWFELEdBZE0sQ0FBUDtBQWVEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGlzTmlsIGZyb20gJ2xvZGFzaC9pc05pbCc7XG5pbXBvcnQgYnVpbGREZWJ1ZyBmcm9tICdkZWJ1Zyc7XG5pbXBvcnQgcmVxdWVzdCwgeyBSZXF1aXJlZFVyaVVybCB9IGZyb20gJ3JlcXVlc3QnO1xuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSAnLi4vbG9nZ2VyJztcbmltcG9ydCB7IEhUVFBfU1RBVFVTIH0gZnJvbSAnLi4vY29uc3RhbnRzJztcblxuY29uc3QgZGVidWcgPSBidWlsZERlYnVnKCd2ZXJkYWNjaW86bm90aWZ5LXJlcXVlc3QnKTtcbmV4cG9ydCBmdW5jdGlvbiBub3RpZnlSZXF1ZXN0KG9wdGlvbnM6IFJlcXVpcmVkVXJpVXJsLCBjb250ZW50KTogUHJvbWlzZTxhbnkgfCBFcnJvcj4ge1xuICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCk6IHZvaWQgPT4ge1xuICAgIHJlcXVlc3Qob3B0aW9ucywgZnVuY3Rpb24gKGVyciwgcmVzcG9uc2UsIGJvZHkpOiB2b2lkIHtcbiAgICAgIGlmIChlcnIgfHwgcmVzcG9uc2Uuc3RhdHVzQ29kZSA+PSBIVFRQX1NUQVRVUy5CQURfUkVRVUVTVCkge1xuICAgICAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSBpc05pbChlcnIpID8gcmVzcG9uc2UuYm9keSA6IGVyci5tZXNzYWdlO1xuICAgICAgICBsb2dnZXIuZXJyb3IoeyBlcnJvck1lc3NhZ2UgfSwgJ25vdGlmeSBzZXJ2aWNlIGhhcyB0aHJvd24gYW4gZXJyb3I6IEB7ZXJyb3JNZXNzYWdlfScpO1xuICAgICAgICByZWplY3QoZXJyb3JNZXNzYWdlKTtcbiAgICAgIH1cbiAgICAgIGxvZ2dlci5pbmZvKHsgY29udGVudCB9LCAnQSBub3RpZmljYXRpb24gaGFzIGJlZW4gc2hpcHBlZDogQHtjb250ZW50fScpO1xuICAgICAgaWYgKGlzTmlsKGJvZHkpID09PSBmYWxzZSkge1xuICAgICAgICBsb2dnZXIuZGVidWcoeyBib2R5IH0sICcgYm9keTogQHtib2R5fScpO1xuICAgICAgICByZXNvbHZlKGJvZHkpO1xuICAgICAgfVxuICAgICAgcmVqZWN0KEVycm9yKCdib2R5IGlzIG1pc3NpbmcnKSk7XG4gICAgfSk7XG4gIH0pO1xufVxuIl19
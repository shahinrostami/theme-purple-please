"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.isObject = isObject;
exports.formatLoggingDate = formatLoggingDate;
exports.fillInMsgTemplate = fillInMsgTemplate;
exports.printMessage = printMessage;
exports.FORMAT_DATE = exports.CUSTOM_PAD_LENGTH = void 0;

var _util = require("util");

var _kleur = require("kleur");

var _lodash = _interopRequireDefault(require("lodash"));

var _dayjs = _interopRequireDefault(require("dayjs"));

var _levels = require("../levels");

var _utils = require("../utils");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const CUSTOM_PAD_LENGTH = 1;
exports.CUSTOM_PAD_LENGTH = CUSTOM_PAD_LENGTH;
const FORMAT_DATE = 'YYYY-MM-DD HH:mm:ss';
exports.FORMAT_DATE = FORMAT_DATE;

function isObject(obj) {
  return _lodash.default.isObject(obj) && _lodash.default.isNull(obj) === false && _lodash.default.isArray(obj) === false;
}

function formatLoggingDate(time, message) {
  const timeFormatted = (0, _dayjs.default)(time).format(FORMAT_DATE);
  return `[${timeFormatted}]${message}`;
}

let LEVEL_VALUE_MAX = 0; // eslint-disable-next-line guard-for-in

for (const l in _levels.levelsColors) {
  LEVEL_VALUE_MAX = Math.max(LEVEL_VALUE_MAX, l.length);
}

const ERROR_FLAG = '!';

function fillInMsgTemplate(msg, templateOptions, colors) {
  const templateRegex = /@{(!?[$A-Za-z_][$0-9A-Za-z\._]*)}/g;
  return msg.replace(templateRegex, (_, name) => {
    let str = templateOptions;
    let isError;

    if (name[0] === ERROR_FLAG) {
      name = name.substr(1);
      isError = true;
    } // object can be @{foo.bar.}


    const listAccessors = name.split('.');

    for (let property = 0; property < listAccessors.length; property++) {
      const id = listAccessors[property];

      if (isObject(str)) {
        str = str[id];
      }
    }

    if (typeof str === 'string') {
      if (colors === false || str.includes('\n')) {
        return str;
      } else if (isError) {
        return (0, _kleur.red)(str);
      }

      return (0, _kleur.green)(str);
    } // object, showHidden, depth, colors


    return (0, _util.inspect)(str, undefined, null, colors);
  });
}

function getMessage(debugLevel, msg, sub, templateObjects, hasColors) {
  const finalMessage = fillInMsgTemplate(msg, templateObjects, hasColors);
  const subSystemType = _levels.subSystemLevels.color[sub !== null && sub !== void 0 ? sub : 'default'];

  if (hasColors) {
    const logString = `${_levels.levelsColors[debugLevel]((0, _utils.padRight)(debugLevel, LEVEL_VALUE_MAX))}${(0, _kleur.white)(`${subSystemType} ${finalMessage}`)}`;
    return (0, _utils.padLeft)(logString);
  }

  const logString = `${(0, _utils.padRight)(debugLevel, LEVEL_VALUE_MAX)}${subSystemType} ${finalMessage}`;
  return (0, _utils.padRight)(logString);
}

function printMessage(templateObjects, options, hasColors = true) {
  const {
    prettyStamp
  } = options;
  const {
    level,
    msg,
    sub
  } = templateObjects;
  const debugLevel = (0, _levels.calculateLevel)(level);
  const logMessage = getMessage(debugLevel, msg, sub, templateObjects, hasColors);
  return prettyStamp ? formatLoggingDate(templateObjects.time, logMessage) : logMessage;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9saWIvbG9nZ2VyL2Zvcm1hdHRlci9wcmV0dGlmaWVyLnRzIl0sIm5hbWVzIjpbIkNVU1RPTV9QQURfTEVOR1RIIiwiRk9STUFUX0RBVEUiLCJpc09iamVjdCIsIm9iaiIsIl8iLCJpc051bGwiLCJpc0FycmF5IiwiZm9ybWF0TG9nZ2luZ0RhdGUiLCJ0aW1lIiwibWVzc2FnZSIsInRpbWVGb3JtYXR0ZWQiLCJmb3JtYXQiLCJMRVZFTF9WQUxVRV9NQVgiLCJsIiwibGV2ZWxzQ29sb3JzIiwiTWF0aCIsIm1heCIsImxlbmd0aCIsIkVSUk9SX0ZMQUciLCJmaWxsSW5Nc2dUZW1wbGF0ZSIsIm1zZyIsInRlbXBsYXRlT3B0aW9ucyIsImNvbG9ycyIsInRlbXBsYXRlUmVnZXgiLCJyZXBsYWNlIiwibmFtZSIsInN0ciIsImlzRXJyb3IiLCJzdWJzdHIiLCJsaXN0QWNjZXNzb3JzIiwic3BsaXQiLCJwcm9wZXJ0eSIsImlkIiwiaW5jbHVkZXMiLCJ1bmRlZmluZWQiLCJnZXRNZXNzYWdlIiwiZGVidWdMZXZlbCIsInN1YiIsInRlbXBsYXRlT2JqZWN0cyIsImhhc0NvbG9ycyIsImZpbmFsTWVzc2FnZSIsInN1YlN5c3RlbVR5cGUiLCJzdWJTeXN0ZW1MZXZlbHMiLCJjb2xvciIsImxvZ1N0cmluZyIsInByaW50TWVzc2FnZSIsIm9wdGlvbnMiLCJwcmV0dHlTdGFtcCIsImxldmVsIiwibG9nTWVzc2FnZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFHQTs7QUFDQTs7OztBQUVPLE1BQU1BLGlCQUFpQixHQUFHLENBQTFCOztBQUNBLE1BQU1DLFdBQVcsR0FBRyxxQkFBcEI7OztBQUVBLFNBQVNDLFFBQVQsQ0FBa0JDLEdBQWxCLEVBQXlDO0FBQzVDLFNBQU9DLGdCQUFFRixRQUFGLENBQVdDLEdBQVgsS0FBbUJDLGdCQUFFQyxNQUFGLENBQVNGLEdBQVQsTUFBa0IsS0FBckMsSUFBOENDLGdCQUFFRSxPQUFGLENBQVVILEdBQVYsTUFBbUIsS0FBeEU7QUFDSDs7QUFFTSxTQUFTSSxpQkFBVCxDQUEyQkMsSUFBM0IsRUFBeUNDLE9BQXpDLEVBQTBEO0FBQzdELFFBQU1DLGFBQWEsR0FBRyxvQkFBTUYsSUFBTixFQUFZRyxNQUFaLENBQW1CVixXQUFuQixDQUF0QjtBQUVBLFNBQVEsSUFBR1MsYUFBYyxJQUFHRCxPQUFRLEVBQXBDO0FBQ0g7O0FBS0QsSUFBSUcsZUFBZSxHQUFHLENBQXRCLEMsQ0FDQTs7QUFDQSxLQUFLLE1BQU1DLENBQVgsSUFBZ0JDLG9CQUFoQixFQUE4QjtBQUM1QkYsRUFBQUEsZUFBZSxHQUFHRyxJQUFJLENBQUNDLEdBQUwsQ0FBU0osZUFBVCxFQUEwQkMsQ0FBQyxDQUFDSSxNQUE1QixDQUFsQjtBQUNEOztBQUVELE1BQU1DLFVBQVUsR0FBRyxHQUFuQjs7QUFTTyxTQUFTQyxpQkFBVCxDQUEyQkMsR0FBM0IsRUFBZ0NDLGVBQWhDLEVBQWlFQyxNQUFqRSxFQUFpRjtBQUN0RixRQUFNQyxhQUFhLEdBQUcsb0NBQXRCO0FBRUEsU0FBT0gsR0FBRyxDQUFDSSxPQUFKLENBQVlELGFBQVosRUFBMkIsQ0FBQ25CLENBQUQsRUFBSXFCLElBQUosS0FBcUI7QUFFckQsUUFBSUMsR0FBRyxHQUFHTCxlQUFWO0FBQ0EsUUFBSU0sT0FBSjs7QUFDQSxRQUFJRixJQUFJLENBQUMsQ0FBRCxDQUFKLEtBQVlQLFVBQWhCLEVBQTRCO0FBQzFCTyxNQUFBQSxJQUFJLEdBQUdBLElBQUksQ0FBQ0csTUFBTCxDQUFZLENBQVosQ0FBUDtBQUNBRCxNQUFBQSxPQUFPLEdBQUcsSUFBVjtBQUNELEtBUG9ELENBU3JEOzs7QUFDQSxVQUFNRSxhQUFhLEdBQUdKLElBQUksQ0FBQ0ssS0FBTCxDQUFXLEdBQVgsQ0FBdEI7O0FBQ0EsU0FBSyxJQUFJQyxRQUFRLEdBQUcsQ0FBcEIsRUFBdUJBLFFBQVEsR0FBR0YsYUFBYSxDQUFDWixNQUFoRCxFQUF3RGMsUUFBUSxFQUFoRSxFQUFvRTtBQUNsRSxZQUFNQyxFQUFFLEdBQUdILGFBQWEsQ0FBQ0UsUUFBRCxDQUF4Qjs7QUFDQSxVQUFJN0IsUUFBUSxDQUFDd0IsR0FBRCxDQUFaLEVBQW1CO0FBQ2pCQSxRQUFBQSxHQUFHLEdBQUlBLEdBQUQsQ0FBZ0JNLEVBQWhCLENBQU47QUFDRDtBQUNGOztBQUVELFFBQUksT0FBT04sR0FBUCxLQUFlLFFBQW5CLEVBQTZCO0FBQzNCLFVBQUlKLE1BQU0sS0FBSyxLQUFYLElBQXFCSSxHQUFELENBQWdCTyxRQUFoQixDQUF5QixJQUF6QixDQUF4QixFQUF3RDtBQUN0RCxlQUFPUCxHQUFQO0FBQ0QsT0FGRCxNQUVPLElBQUlDLE9BQUosRUFBYTtBQUNsQixlQUFPLGdCQUFJRCxHQUFKLENBQVA7QUFDRDs7QUFDRCxhQUFPLGtCQUFNQSxHQUFOLENBQVA7QUFDRCxLQXpCb0QsQ0EyQnJEOzs7QUFDQSxXQUFPLG1CQUFRQSxHQUFSLEVBQWFRLFNBQWIsRUFBd0IsSUFBeEIsRUFBOEJaLE1BQTlCLENBQVA7QUFDRCxHQTdCTSxDQUFQO0FBOEJEOztBQUVELFNBQVNhLFVBQVQsQ0FBb0JDLFVBQXBCLEVBQWdDaEIsR0FBaEMsRUFBcUNpQixHQUFyQyxFQUEwQ0MsZUFBMUMsRUFBMkRDLFNBQTNELEVBQXNFO0FBQ3BFLFFBQU1DLFlBQVksR0FBR3JCLGlCQUFpQixDQUFDQyxHQUFELEVBQU1rQixlQUFOLEVBQXVCQyxTQUF2QixDQUF0QztBQUVBLFFBQU1FLGFBQWEsR0FBR0Msd0JBQWdCQyxLQUFoQixDQUFzQk4sR0FBdEIsYUFBc0JBLEdBQXRCLGNBQXNCQSxHQUF0QixHQUE2QixTQUE3QixDQUF0Qjs7QUFDQSxNQUFJRSxTQUFKLEVBQWU7QUFDYixVQUFNSyxTQUFTLEdBQUksR0FBRTlCLHFCQUFhc0IsVUFBYixFQUF5QixxQkFBU0EsVUFBVCxFQUFxQnhCLGVBQXJCLENBQXpCLENBQWdFLEdBQUUsa0JBQU8sR0FBRTZCLGFBQWMsSUFBR0QsWUFBYSxFQUF2QyxDQUEwQyxFQUFqSTtBQUVBLFdBQU8sb0JBQVFJLFNBQVIsQ0FBUDtBQUNEOztBQUNELFFBQU1BLFNBQVMsR0FBSSxHQUFFLHFCQUFTUixVQUFULEVBQXFCeEIsZUFBckIsQ0FBc0MsR0FBRTZCLGFBQWMsSUFBR0QsWUFBYSxFQUEzRjtBQUVBLFNBQU8scUJBQVNJLFNBQVQsQ0FBUDtBQUNEOztBQUVNLFNBQVNDLFlBQVQsQ0FDSFAsZUFERyxFQUVIUSxPQUZHLEVBR0hQLFNBQVMsR0FBRyxJQUhULEVBR3VCO0FBQzVCLFFBQU07QUFBRVEsSUFBQUE7QUFBRixNQUFrQkQsT0FBeEI7QUFDQSxRQUFNO0FBQUVFLElBQUFBLEtBQUY7QUFBUzVCLElBQUFBLEdBQVQ7QUFBY2lCLElBQUFBO0FBQWQsTUFBc0JDLGVBQTVCO0FBQ0EsUUFBTUYsVUFBVSxHQUFHLDRCQUFlWSxLQUFmLENBQW5CO0FBQ0EsUUFBTUMsVUFBVSxHQUFHZCxVQUFVLENBQUNDLFVBQUQsRUFBYWhCLEdBQWIsRUFBa0JpQixHQUFsQixFQUF1QkMsZUFBdkIsRUFBd0NDLFNBQXhDLENBQTdCO0FBRUEsU0FBT1EsV0FBVyxHQUFHeEMsaUJBQWlCLENBQUMrQixlQUFlLENBQUM5QixJQUFqQixFQUFpQ3lDLFVBQWpDLENBQXBCLEdBQW1FQSxVQUFyRjtBQUNEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgaW5zcGVjdCB9IGZyb20gJ3V0aWwnO1xuaW1wb3J0IHsgd2hpdGUsIHJlZCwgZ3JlZW4gfSBmcm9tICdrbGV1cic7XG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IGRheWpzIGZyb20gJ2RheWpzJztcbmltcG9ydCB7UHJldHR5T3B0aW9uc30gZnJvbSBcInBpbm9cIjtcblxuaW1wb3J0IHtjYWxjdWxhdGVMZXZlbCwgTGV2ZWxDb2RlLCBsZXZlbHNDb2xvcnMsIHN1YlN5c3RlbUxldmVsc30gZnJvbSBcIi4uL2xldmVsc1wiO1xuaW1wb3J0IHsgcGFkTGVmdCwgcGFkUmlnaHQgfSBmcm9tICcuLi91dGlscyc7XG5cbmV4cG9ydCBjb25zdCBDVVNUT01fUEFEX0xFTkdUSCA9IDE7XG5leHBvcnQgY29uc3QgRk9STUFUX0RBVEUgPSAnWVlZWS1NTS1ERCBISDptbTpzcyc7XG5cbmV4cG9ydCBmdW5jdGlvbiBpc09iamVjdChvYmo6IHVua25vd24pOiBib29sZWFuIHtcbiAgICByZXR1cm4gXy5pc09iamVjdChvYmopICYmIF8uaXNOdWxsKG9iaikgPT09IGZhbHNlICYmIF8uaXNBcnJheShvYmopID09PSBmYWxzZTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGZvcm1hdExvZ2dpbmdEYXRlKHRpbWU6IG51bWJlciwgbWVzc2FnZSk6IHN0cmluZyB7XG4gICAgY29uc3QgdGltZUZvcm1hdHRlZCA9IGRheWpzKHRpbWUpLmZvcm1hdChGT1JNQVRfREFURSk7XG5cbiAgICByZXR1cm4gYFske3RpbWVGb3JtYXR0ZWR9XSR7bWVzc2FnZX1gO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlICBQcmV0dHlPcHRpb25zRXh0ZW5kZWQgZXh0ZW5kcyBQcmV0dHlPcHRpb25zIHtcblx0cHJldHR5U3RhbXA6IGJvb2xlYW47XG59XG5sZXQgTEVWRUxfVkFMVUVfTUFYID0gMDtcbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBndWFyZC1mb3ItaW5cbmZvciAoY29uc3QgbCBpbiBsZXZlbHNDb2xvcnMpIHtcbiAgTEVWRUxfVkFMVUVfTUFYID0gTWF0aC5tYXgoTEVWRUxfVkFMVUVfTUFYLCBsLmxlbmd0aCk7XG59XG5cbmNvbnN0IEVSUk9SX0ZMQUcgPSAnISc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgT2JqZWN0VGVtcGxhdGUge1xuICBsZXZlbDogTGV2ZWxDb2RlO1xuICBtc2c6IHN0cmluZztcbiAgc3ViPzogc3RyaW5nO1xuICBba2V5OiBzdHJpbmddOiBzdHJpbmcgfCBudW1iZXIgfCBvYmplY3QgfCBudWxsIHwgdm9pZDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGZpbGxJbk1zZ1RlbXBsYXRlKG1zZywgdGVtcGxhdGVPcHRpb25zOiBPYmplY3RUZW1wbGF0ZSwgY29sb3JzKTogc3RyaW5nIHtcbiAgY29uc3QgdGVtcGxhdGVSZWdleCA9IC9AeyghP1skQS1aYS16X11bJDAtOUEtWmEtelxcLl9dKil9L2c7XG5cbiAgcmV0dXJuIG1zZy5yZXBsYWNlKHRlbXBsYXRlUmVnZXgsIChfLCBuYW1lKTogc3RyaW5nID0+IHtcblxuICAgIGxldCBzdHIgPSB0ZW1wbGF0ZU9wdGlvbnM7XG4gICAgbGV0IGlzRXJyb3I7XG4gICAgaWYgKG5hbWVbMF0gPT09IEVSUk9SX0ZMQUcpIHtcbiAgICAgIG5hbWUgPSBuYW1lLnN1YnN0cigxKTtcbiAgICAgIGlzRXJyb3IgPSB0cnVlO1xuICAgIH1cblxuICAgIC8vIG9iamVjdCBjYW4gYmUgQHtmb28uYmFyLn1cbiAgICBjb25zdCBsaXN0QWNjZXNzb3JzID0gbmFtZS5zcGxpdCgnLicpO1xuICAgIGZvciAobGV0IHByb3BlcnR5ID0gMDsgcHJvcGVydHkgPCBsaXN0QWNjZXNzb3JzLmxlbmd0aDsgcHJvcGVydHkrKykge1xuICAgICAgY29uc3QgaWQgPSBsaXN0QWNjZXNzb3JzW3Byb3BlcnR5XTtcbiAgICAgIGlmIChpc09iamVjdChzdHIpKSB7XG4gICAgICAgIHN0ciA9IChzdHIgYXMgb2JqZWN0KVtpZF07XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKHR5cGVvZiBzdHIgPT09ICdzdHJpbmcnKSB7XG4gICAgICBpZiAoY29sb3JzID09PSBmYWxzZSB8fCAoc3RyIGFzIHN0cmluZykuaW5jbHVkZXMoJ1xcbicpKSB7XG4gICAgICAgIHJldHVybiBzdHI7XG4gICAgICB9IGVsc2UgaWYgKGlzRXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIHJlZChzdHIpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGdyZWVuKHN0cik7XG4gICAgfVxuXG4gICAgLy8gb2JqZWN0LCBzaG93SGlkZGVuLCBkZXB0aCwgY29sb3JzXG4gICAgcmV0dXJuIGluc3BlY3Qoc3RyLCB1bmRlZmluZWQsIG51bGwsIGNvbG9ycyk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBnZXRNZXNzYWdlKGRlYnVnTGV2ZWwsIG1zZywgc3ViLCB0ZW1wbGF0ZU9iamVjdHMsIGhhc0NvbG9ycykge1xuICBjb25zdCBmaW5hbE1lc3NhZ2UgPSBmaWxsSW5Nc2dUZW1wbGF0ZShtc2csIHRlbXBsYXRlT2JqZWN0cywgaGFzQ29sb3JzKTtcblxuICBjb25zdCBzdWJTeXN0ZW1UeXBlID0gc3ViU3lzdGVtTGV2ZWxzLmNvbG9yW3N1YiA/PyAnZGVmYXVsdCddO1xuICBpZiAoaGFzQ29sb3JzKSB7XG4gICAgY29uc3QgbG9nU3RyaW5nID0gYCR7bGV2ZWxzQ29sb3JzW2RlYnVnTGV2ZWxdKHBhZFJpZ2h0KGRlYnVnTGV2ZWwsIExFVkVMX1ZBTFVFX01BWCkpfSR7d2hpdGUoYCR7c3ViU3lzdGVtVHlwZX0gJHtmaW5hbE1lc3NhZ2V9YCl9YDtcblxuICAgIHJldHVybiBwYWRMZWZ0KGxvZ1N0cmluZyk7XG4gIH1cbiAgY29uc3QgbG9nU3RyaW5nID0gYCR7cGFkUmlnaHQoZGVidWdMZXZlbCwgTEVWRUxfVkFMVUVfTUFYKX0ke3N1YlN5c3RlbVR5cGV9ICR7ZmluYWxNZXNzYWdlfWA7XG5cbiAgcmV0dXJuIHBhZFJpZ2h0KGxvZ1N0cmluZyk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwcmludE1lc3NhZ2UoXG4gICAgdGVtcGxhdGVPYmplY3RzOiBPYmplY3RUZW1wbGF0ZSxcbiAgICBvcHRpb25zOiBQcmV0dHlPcHRpb25zRXh0ZW5kZWQsXG4gICAgaGFzQ29sb3JzID0gdHJ1ZSk6IHN0cmluZyB7XG4gIGNvbnN0IHsgcHJldHR5U3RhbXAgfSA9IG9wdGlvbnM7XG4gIGNvbnN0IHsgbGV2ZWwsIG1zZywgc3ViIH0gPSB0ZW1wbGF0ZU9iamVjdHM7XG4gIGNvbnN0IGRlYnVnTGV2ZWwgPSBjYWxjdWxhdGVMZXZlbChsZXZlbCk7XG4gIGNvbnN0IGxvZ01lc3NhZ2UgPSBnZXRNZXNzYWdlKGRlYnVnTGV2ZWwsIG1zZywgc3ViLCB0ZW1wbGF0ZU9iamVjdHMsIGhhc0NvbG9ycyk7XG5cbiAgcmV0dXJuIHByZXR0eVN0YW1wID8gZm9ybWF0TG9nZ2luZ0RhdGUodGVtcGxhdGVPYmplY3RzLnRpbWUgYXMgbnVtYmVyLCBsb2dNZXNzYWdlKSA6IGxvZ01lc3NhZ2U7XG59XG4iXX0=
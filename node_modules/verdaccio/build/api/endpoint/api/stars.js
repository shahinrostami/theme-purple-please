"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = _default;

var _lodash = _interopRequireDefault(require("lodash"));

var _constants = require("../../../lib/constants");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * @prettier

 */
function _default(route, storage) {
  route.get('/-/_view/starredByUser', (req, res, next) => {
    const remoteUsername = req.remote_user.name;
    storage.getLocalDatabase((err, localPackages) => {
      if (err) {
        return next(err);
      }

      const filteredPackages = localPackages.filter(localPackage => _lodash.default.keys(localPackage[_constants.USERS]).includes(remoteUsername));
      res.status(_constants.HTTP_STATUS.OK);
      next({
        rows: filteredPackages.map(filteredPackage => ({
          value: filteredPackage.name
        }))
      });
    });
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9hcGkvZW5kcG9pbnQvYXBpL3N0YXJzLnRzIl0sIm5hbWVzIjpbInJvdXRlIiwic3RvcmFnZSIsImdldCIsInJlcSIsInJlcyIsIm5leHQiLCJyZW1vdGVVc2VybmFtZSIsInJlbW90ZV91c2VyIiwibmFtZSIsImdldExvY2FsRGF0YWJhc2UiLCJlcnIiLCJsb2NhbFBhY2thZ2VzIiwiZmlsdGVyZWRQYWNrYWdlcyIsImZpbHRlciIsImxvY2FsUGFja2FnZSIsIl8iLCJrZXlzIiwiVVNFUlMiLCJpbmNsdWRlcyIsInN0YXR1cyIsIkhUVFBfU1RBVFVTIiwiT0siLCJyb3dzIiwibWFwIiwiZmlsdGVyZWRQYWNrYWdlIiwidmFsdWUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFJQTs7QUFHQTs7OztBQVBBO0FBQ0E7QUFDQTtBQUNBO0FBU2Usa0JBQVVBLEtBQVYsRUFBeUJDLE9BQXpCLEVBQXlEO0FBQ3RFRCxFQUFBQSxLQUFLLENBQUNFLEdBQU4sQ0FDRSx3QkFERixFQUVFLENBQUNDLEdBQUQsRUFBc0JDLEdBQXRCLEVBQXFDQyxJQUFyQyxLQUFzRTtBQUNwRSxVQUFNQyxjQUFjLEdBQUdILEdBQUcsQ0FBQ0ksV0FBSixDQUFnQkMsSUFBdkM7QUFFQVAsSUFBQUEsT0FBTyxDQUFDUSxnQkFBUixDQUF5QixDQUFDQyxHQUFELEVBQU1DLGFBQU4sS0FBa0M7QUFDekQsVUFBSUQsR0FBSixFQUFTO0FBQ1AsZUFBT0wsSUFBSSxDQUFDSyxHQUFELENBQVg7QUFDRDs7QUFFRCxZQUFNRSxnQkFBMEIsR0FBR0QsYUFBYSxDQUFDRSxNQUFkLENBQXNCQyxZQUFELElBQ3REQyxnQkFBRUMsSUFBRixDQUFPRixZQUFZLENBQUNHLGdCQUFELENBQW5CLEVBQTRCQyxRQUE1QixDQUFxQ1osY0FBckMsQ0FEaUMsQ0FBbkM7QUFJQUYsTUFBQUEsR0FBRyxDQUFDZSxNQUFKLENBQVdDLHVCQUFZQyxFQUF2QjtBQUNBaEIsTUFBQUEsSUFBSSxDQUFDO0FBQ0hpQixRQUFBQSxJQUFJLEVBQUVWLGdCQUFnQixDQUFDVyxHQUFqQixDQUFzQkMsZUFBRCxLQUErQjtBQUN4REMsVUFBQUEsS0FBSyxFQUFFRCxlQUFlLENBQUNoQjtBQURpQyxTQUEvQixDQUFyQjtBQURILE9BQUQsQ0FBSjtBQUtELEtBZkQ7QUFnQkQsR0FyQkg7QUF1QkQiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBwcmV0dGllclxuXG4gKi9cbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyBSZXNwb25zZSwgUm91dGVyIH0gZnJvbSAnZXhwcmVzcyc7XG5pbXBvcnQgeyBQYWNrYWdlIH0gZnJvbSAnQHZlcmRhY2Npby90eXBlcyc7XG5pbXBvcnQgeyBVU0VSUywgSFRUUF9TVEFUVVMgfSBmcm9tICcuLi8uLi8uLi9saWIvY29uc3RhbnRzJztcbmltcG9ydCB7ICRSZXF1ZXN0RXh0ZW5kLCAkTmV4dEZ1bmN0aW9uVmVyLCBJU3RvcmFnZUhhbmRsZXIgfSBmcm9tICcuLi8uLi8uLi8uLi90eXBlcyc7XG5cbnR5cGUgUGFja2FnZXMgPSBQYWNrYWdlW107XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIChyb3V0ZTogUm91dGVyLCBzdG9yYWdlOiBJU3RvcmFnZUhhbmRsZXIpOiB2b2lkIHtcbiAgcm91dGUuZ2V0KFxuICAgICcvLS9fdmlldy9zdGFycmVkQnlVc2VyJyxcbiAgICAocmVxOiAkUmVxdWVzdEV4dGVuZCwgcmVzOiBSZXNwb25zZSwgbmV4dDogJE5leHRGdW5jdGlvblZlcik6IHZvaWQgPT4ge1xuICAgICAgY29uc3QgcmVtb3RlVXNlcm5hbWUgPSByZXEucmVtb3RlX3VzZXIubmFtZTtcblxuICAgICAgc3RvcmFnZS5nZXRMb2NhbERhdGFiYXNlKChlcnIsIGxvY2FsUGFja2FnZXM6IFBhY2thZ2VzKSA9PiB7XG4gICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICByZXR1cm4gbmV4dChlcnIpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgZmlsdGVyZWRQYWNrYWdlczogUGFja2FnZXMgPSBsb2NhbFBhY2thZ2VzLmZpbHRlcigobG9jYWxQYWNrYWdlOiBQYWNrYWdlKSA9PlxuICAgICAgICAgIF8ua2V5cyhsb2NhbFBhY2thZ2VbVVNFUlNdKS5pbmNsdWRlcyhyZW1vdGVVc2VybmFtZSlcbiAgICAgICAgKTtcblxuICAgICAgICByZXMuc3RhdHVzKEhUVFBfU1RBVFVTLk9LKTtcbiAgICAgICAgbmV4dCh7XG4gICAgICAgICAgcm93czogZmlsdGVyZWRQYWNrYWdlcy5tYXAoKGZpbHRlcmVkUGFja2FnZTogUGFja2FnZSkgPT4gKHtcbiAgICAgICAgICAgIHZhbHVlOiBmaWx0ZXJlZFBhY2thZ2UubmFtZVxuICAgICAgICAgIH0pKVxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH1cbiAgKTtcbn1cbiJdfQ==
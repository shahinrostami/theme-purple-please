{"version":3,"sources":["../src/pkg-utils.ts"],"names":["loadPrivatePackages","path","logger","list","emptyDatabase","secret","data","fs","readFileSync","_","isNil","db","JSON","parse","err","error","Error","isEmpty"],"mappings":";;;;;;;AAAA;;AAEA;;;;AAGO,SAASA,mBAAT,CAA6BC,IAA7B,EAA2CC,MAA3C,EAAyE;AAC9E,QAAMC,IAAiB,GAAG,EAA1B;AACA,QAAMC,aAAa,GAAG;AAAED,IAAAA,IAAF;AAAQE,IAAAA,MAAM,EAAE;AAAhB,GAAtB;;AACA,QAAMC,IAAI,GAAGC,YAAGC,YAAH,CAAgBP,IAAhB,EAAsB,MAAtB,CAAb;;AAEA,MAAIQ,gBAAEC,KAAF,CAAQJ,IAAR,CAAJ,EAAmB;AACjB;AACA,WAAOF,aAAP;AACD;;AAED,MAAIO,EAAJ;;AACA,MAAI;AACFA,IAAAA,EAAE,GAAGC,IAAI,CAACC,KAAL,CAAWP,IAAX,CAAL;AACD,GAFD,CAEE,OAAOQ,GAAP,EAAY;AACZZ,IAAAA,MAAM,CAACa,KAAP,CACG,wEAAD,GAA4E,+BAA8Bd,IAAK,EADjH,EAEEa,GAFF;AAIA,UAAME,KAAK,CAAC,gDAAD,CAAX;AACD;;AAED,MAAIP,gBAAEQ,OAAF,CAAUN,EAAV,CAAJ,EAAmB;AACjB,WAAOP,aAAP;AACD;;AAED,SAAOO,EAAP;AACD","sourcesContent":["import fs from 'fs';\n\nimport _ from 'lodash';\nimport { LocalStorage, StorageList, Logger } from '@verdaccio/types';\n\nexport function loadPrivatePackages(path: string, logger: Logger): LocalStorage {\n  const list: StorageList = [];\n  const emptyDatabase = { list, secret: '' };\n  const data = fs.readFileSync(path, 'utf8');\n\n  if (_.isNil(data)) {\n    // readFileSync is platform specific, FreeBSD might return null\n    return emptyDatabase;\n  }\n\n  let db;\n  try {\n    db = JSON.parse(data);\n  } catch (err) {\n    logger.error(\n      `Package database file corrupted (invalid JSON), please check the error` + ` printed below.\\nFile Path: ${path}`,\n      err\n    );\n    throw Error('Package database file corrupted (invalid JSON)');\n  }\n\n  if (_.isEmpty(db)) {\n    return emptyDatabase;\n  }\n\n  return db;\n}\n"],"file":"pkg-utils.js"}